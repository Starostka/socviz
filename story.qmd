---
title: Storyline
subtitle: Second assignment socviz
---

Let's create a nice story

# Introduction

<!-- - TODO Explaining the dataset
- TODO abstract for the story
- TODO basic summary statistics/info for the dataset -->

San Francisco is well known for its vibrant nightlife and abundance of bars and clubs. This also means that the city has a high rate of alcohol-related incidents, including criminal activity. However, Covid-19 pandemic has changed the way of how people socialized, therefore, we are interested in the impact that Covid has made on the crimes.

In this story, we will explore the San Francisco Police Department's (SFPD) [Incient Report Dataset](https://data.sfgov.org/browse?category=Public+Safety) from __January 2018 to January 2022__, which includes the break-out period of Covid. This dataset is a collection of data on criminal incidents reported in SF, which provides the information of incident date, incident time, incident category, police district, latitude, logitude, etc. The dataset contains 35 columns and 547905 rows within the timeline of January 2018 to January 2022.

**To be discuss: Drunkness is not included in the timeline described above**


## Timeseries : Progression of drunkiness 
<!--  One time-series / bar chart (it's OK to use the "fancy" plot-typs like calendar plots or polar bar-charts from Week 2, Part 4). -->
> [reference]: https://data.sfgov.org/browse?category=Public+Safety  Dataset

First we investigate how drunkiness changes over time, especially into the period during COVID.
![Calendar plot](https://i.imgur.com/aN7iyQs.png)

Let's look into a few weeks
![Drunkness - weekdays](https://i.imgur.com/1JKFHTL.png)


![Drunkness - hourly](https://i.imgur.com/S8o4guz.png)

## Comparing areas of criminal activity
<!-- One map (use techniques from Week 3 and 4) -->

Here we have an interactive map of San Francisco, allowing us to zoom into a more specific area and investigate drunkineess and other criminal activity between different streets.  
![Map of SF](https://i.imgur.com/6Zctfgi.png)

![Zoom in heatmaps of 2 clusters](https://i.imgur.com/9oy7O53.png)

compare 2 streets (Market Street vs. Catro Street) with strong density of occurences of drunkness, and see what is going on

For now assume we do one map includes 2 streets and the clusters of incidents. And attempt to present them by zooming in the streets seperately

**Cluster Correlation idea:** Furthermore, we can select two clusters and a little info box pops up over the cursor printing the correlation between the two clusters.


```{python}
import folium
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from folium.plugins import HeatMap

df_before_2018 = pd.read_csv('data/Police_Department_Incident_Reports__Historical_2003_to_May_2018.csv')
df_before_2018['Date'] = pd.to_datetime(df_before_2018['Date'])
df_before_2018['Year'] = df_before_2018['Date'].dt.year
df_before_2018['Month'] = df_before_2018['Date'].dt.month
df_before_2018['Hour'] = pd.DatetimeIndex(df_before_2018['Time']).hour
df_before_2018 = df_before_2018.loc[df_before_2018['Year'] != 2018]

constraint = (df_before_2018['Category'] == 'ROBBERY') & (df_before_2018['Year'] >= 2011) & (df_before_2018['Year'] <= 2012) & (df_before_2018['Resolution'] == "ARREST, BOOKED")
df_robbery_heat = df_before_2018.loc[constraint].reset_index(drop=True)
x_y_robbery = list(zip(list(df_robbery_heat["Y"]), list(df_robbery_heat["X"])))


SF_map = folium.Map(location=[37.77919, -122.41914],
                    zoom_start = 12,
                    tiles = "openstreetmap")
HeatMap(x_y_robbery, min_opacity=0.35, overlay=True).add_to(SF_map)

SF_map
```

## Filtering, selecting for group (drunkiness)
<!-- One interactive visualization in Bokeh (Week 6) -->

**First idea for interactive plot:**

Filter based on categories, on selection a little info box with a description tells the user about the category.

**Second idea for interactive plot:**

TODO: investigate some specific event happening in san francisco during the date frame in our dataset(political, shootout, demonstration, party, car chase)

Allow the user to interactive plot different events. And maybe how drunkiness (or some other criminal activity) was related.


__Questions__
- Are we limited to the dataset/timeframe? (Is it possible to look into the data after 2020 during covid?)
- Can we include multiple datasets? (as supplementery)

```python
from sandbox.preprocess import preprocess_dataset1
dataset = get_lightweight_dataset()
ojs_define(data = dataset)
```

```ojs
viewof categories = Inputs.checkbox(
  ["Assault", "Robbery", "Gambling"],
  { value: ["ASSAULT"],
    label: "Categories:"
  }
)

filtered = transpose(data).filter(function(incident) {
  return categories.includes(incident.category)
})


```